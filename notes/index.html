<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Notes</title>
    
    <!-- Preconnect for faster CDN loads -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://www.gstatic.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="app.js" as="script">
    
    <!-- Favicon -->
    <link href="https://arjunchakri.github.io/favicon.png" rel="icon" sizes="16x16">
    
    <!-- Fonts - with display swap for faster text rendering -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Fira+Code:wght@400;500&display=swap">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase (defer not used as it's needed early) -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <!-- Monaco Editor Loader -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
</head>
<body>
    <div class="glow-orb orb1"></div>
    <div class="glow-orb orb2"></div>

    <!-- Terminal Login -->
    <div class="terminal-wrapper" id="terminalWrapper">
        <div class="terminal" id="terminal">
            <div class="terminal-header">
                <div class="terminal-dots">
                    <div class="dot red"></div>
                    <div class="dot yellow"></div>
                    <div class="dot green"></div>
                </div>
                <div class="terminal-title">notes@cloud ~ zsh</div>
            </div>
            <div class="terminal-body">
                <!-- Landing Content -->
                <div id="landingContent">
                    <pre class="ascii-art">
 ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
 ‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ñà‚ñà‚ïó‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
 ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
 ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë
 ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë
 ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù    ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù</pre>
                    <p class="welcome-text">Real-time collaborative notes ‚Ä¢ <span>Synced</span></p>
                    
                    <div class="input-area">
                        <div class="prompt-line">
                            <span class="prompt">guest</span>
                            <span class="prompt-path">~/notes</span>
                            <span class="prompt-symbol">‚ùØ</span>
                            <input type="text" id="noteInput" class="input-field" placeholder="enter note name..." autocomplete="off" autofocus>
                        </div>
                        <p class="hint">Press <kbd>Enter</kbd> to connect</p>
                    </div>

                    <div class="recent" id="recent" style="display: none;">
                        <div class="recent-title">‚Ü≥ Recent Sessions</div>
                        <div class="recent-list" id="recentList"></div>
                    </div>
                </div>

                <!-- Boot Sequence -->
                <div class="boot-sequence" id="bootSequence">
                    <div class="boot-line" id="boot-connect">
                        <span class="status"><div class="spinner"></div></span>
                        <span class="text">Connecting to Firebase</span>
                        <span class="time" id="boot-connect-time"></span>
                    </div>
                    <div class="boot-line" id="boot-load">
                        <span class="status"><div class="spinner"></div></span>
                        <span class="text">Loading note: <span class="highlight" id="bootNoteName">-</span></span>
                        <span class="time" id="boot-load-time"></span>
                    </div>
                    <div class="boot-line" id="boot-editor">
                        <span class="status"><div class="spinner"></div></span>
                        <span class="text">Initializing editor</span>
                        <span class="time" id="boot-editor-time"></span>
                    </div>
                    <div class="boot-line" id="boot-collab">
                        <span class="status"><div class="spinner"></div></span>
                        <span class="text">Setting up collaboration</span>
                        <span class="time" id="boot-collab-time"></span>
                    </div>
                    <div class="boot-line" id="boot-ready">
                        <span class="status"><div class="spinner"></div></span>
                        <span class="text highlight">Ready to edit!</span>
                        <span class="time" id="boot-ready-time"></span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
                    <div class="boot-status-text" id="bootStatusText">Initializing...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Editor View -->
    <div class="editor-container" id="editorContainer">
        <div class="toolbar">
            <div class="toolbar-left">
                <button class="back-btn" onclick="goHome()" title="Disconnect">‚Üê</button>
                <span class="note-name" id="noteName">note</span>
                <div class="sync-status" id="syncStatus" title="Sync status">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Synced</span>
                </div>
                
                <!-- View Tabs -->
                <div class="view-tabs">
                    <button class="view-tab active" onclick="switchView('code')" id="codeTab">
                        <span class="tab-icon">üìù</span>
                        <span>Code</span>
                    </button>
                    <button class="view-tab" onclick="switchView('screenshare')" id="screenshareTab">
                        <span class="tab-icon">üñ•Ô∏è</span>
                        <span>Screen</span>
                    </button>
                </div>
                
                <!-- Live indicator when someone is sharing -->
                <div class="live-indicator" id="liveIndicator" style="display:none">
                    <span class="live-dot"></span>
                    <span class="live-text">LIVE</span>
                    <span class="live-user" id="liveUser"></span>
                </div>
                
                <div class="online-users" id="onlineUsers"></div>
            </div>

            <div class="toolbar-right">
                <div class="user-badge" onclick="showRenameModal()" title="Click to rename">
                    <div class="user-dot" id="userDot"></div>
                    <span class="user-name" id="userName">-</span>
                </div>

                <!-- Settings Dropdown -->
                <div class="dropdown">
                    <button class="toolbar-btn settings-btn" onclick="toggleDropdown('settingsMenu')" title="Settings">‚öôÔ∏è</button>
                    <div class="dropdown-menu" id="settingsMenu">
                        <div class="dropdown-section">
                            <div class="dropdown-label">Language</div>
                            <select class="lang-select-dropdown" id="langSelect" onchange="changeLanguage()">
                                <option value="plaintext" selected>Plain Text</option>
                                <option value="javascript">JavaScript</option>
                                <option value="typescript">TypeScript</option>
                                <option value="python">Python</option>
                                <option value="java">Java</option>
                                <option value="cpp">C++</option>
                                <option value="csharp">C#</option>
                                <option value="go">Go</option>
                                <option value="rust">Rust</option>
                                <option value="sql">SQL</option>
                                <option value="json">JSON</option>
                                <option value="xml">XML</option>
                                <option value="html">HTML</option>
                                <option value="css">CSS</option>
                                <option value="yaml">YAML</option>
                                <option value="shell">Shell</option>
                            </select>
                        </div>
                        <div class="dropdown-section">
                            <div class="dropdown-label">Theme</div>
                            <div class="theme-row">
                                <button class="theme-btn dark active" onclick="setTheme('dark')" title="Dark"></button>
                                <button class="theme-btn light" onclick="setTheme('light')" title="Light"></button>
                                <button class="theme-btn contrast" onclick="setTheme('contrast')" title="High Contrast"></button>
                            </div>
                        </div>
                        <div class="dropdown-section">
                            <div class="dropdown-label">Font Size</div>
                            <div class="font-row">
                                <button class="font-btn" onclick="changeFontSize(-1)">‚àí</button>
                                <span class="font-value" id="fontSizeDisplay">14</span>
                                <button class="font-btn" onclick="changeFontSize(1)">+</button>
                            </div>
                        </div>
                        <div class="dropdown-section">
                            <div class="dropdown-item" id="wrapBtn" onclick="toggleWrap()">
                                <span class="icon">‚Ü©</span>
                                <span class="label">Word Wrap</span>
                                <span class="value" id="wrapStatus">Off</span>
                            </div>
                            <div class="dropdown-item" id="minimapBtn" onclick="toggleMinimap()">
                                <span class="icon">‚ñÆ</span>
                                <span class="label">Minimap</span>
                                <span class="value" id="minimapStatus">Off</span>
                            </div>
                            <div class="dropdown-item" id="lineHighlightBtn" onclick="toggleLineHighlight()">
                                <span class="icon">‚îÅ</span>
                                <span class="label">Line Highlight</span>
                                <span class="value" id="highlightStatus">On</span>
                            </div>
                        </div>
                        <div class="dropdown-section">
                            <div class="dropdown-item" onclick="shareFile()">
                                <span class="icon">üì§</span>
                                <span class="label">Send File to Peers</span>
                            </div>
                            <div class="dropdown-item" onclick="copyLink()">
                                <span class="icon">üîó</span>
                                <span class="label">Copy Share Link</span>
                            </div>
                            <div class="dropdown-item" onclick="showShortcuts()">
                                <span class="icon">‚å®</span>
                                <span class="label">Keyboard Shortcuts</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="editor-main">
            <!-- Code Editor -->
            <div id="monaco-container"></div>
            
            <!-- Screenshare -->
            <div class="screenshare-container" id="screenshareContainer">
                <div class="screenshare-toolbar">
                    <!-- Desktop: Screen share button -->
                    <button class="screenshare-btn" id="startShareBtn" onclick="startScreenShare()">
                        <span>üñ•Ô∏è</span>
                        <span>Share Screen</span>
                    </button>
                    <!-- Mobile: Camera share button -->
                    <button class="screenshare-btn camera-btn" id="startCameraBtn" onclick="startCameraShare()">
                        <span>üì∑</span>
                        <span>Share Camera</span>
                    </button>
                    <!-- Stop button -->
                    <button class="screenshare-btn stop" id="stopShareBtn" onclick="stopScreenShare()" style="display:none">
                        <span>‚èπÔ∏è</span>
                        <span>Stop Sharing</span>
                    </button>
                </div>
                <div class="screenshare-video-container" id="videoContainer">
                    <div class="screenshare-placeholder" id="screensharePlaceholder">
                        <div class="screenshare-placeholder-icon">üñ•Ô∏è</div>
                        <div class="screenshare-placeholder-text" id="placeholderText">Click to share your screen or camera</div>
                        <div class="screenshare-placeholder-sub" id="placeholderSub">Other users will see your stream in real-time</div>
                    </div>
                    <!-- Local preview (when you're sharing) -->
                    <video id="localVideo" autoplay playsinline muted style="display:none"></video>
                    <!-- Remote stream (when someone else is sharing) -->
                    <video id="remoteVideo" autoplay playsinline style="display:none"></video>
                </div>
            </div>
        </div>

    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Shortcuts Modal -->
    <div class="modal" id="shortcutsModal" onclick="hideShortcuts()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title">
                ‚å®Ô∏è Keyboard Shortcuts
                <button class="modal-close" onclick="hideShortcuts()">√ó</button>
            </div>
            <div class="shortcut-list">
                <div class="shortcut-item"><span>Save</span><div class="shortcut-key"><span class="key">Ctrl</span><span class="key">S</span></div></div>
                <div class="shortcut-item"><span>Find</span><div class="shortcut-key"><span class="key">Ctrl</span><span class="key">F</span></div></div>
                <div class="shortcut-item"><span>Find & Replace</span><div class="shortcut-key"><span class="key">Ctrl</span><span class="key">H</span></div></div>
                <div class="shortcut-item"><span>Go to Line</span><div class="shortcut-key"><span class="key">Ctrl</span><span class="key">G</span></div></div>
                <div class="shortcut-item"><span>Focus Mode</span><div class="shortcut-key"><span class="key">F11</span></div></div>
                <div class="shortcut-item"><span>Command Palette</span><div class="shortcut-key"><span class="key">F1</span></div></div>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div class="modal" id="renameModal" onclick="hideRenameModal()">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 350px;">
            <div class="modal-title">
                üë§ Change Your Name
                <button class="modal-close" onclick="hideRenameModal()">√ó</button>
            </div>
            <input type="text" id="renameInput" class="input-field" style="width:100%; padding:12px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 16px;" placeholder="Enter new name...">
            <button class="toolbar-btn" style="width:100%; justify-content: center; padding: 12px;" onclick="saveUserName()">Save Name</button>
        </div>
    </div>

    <!-- Incoming File Modal -->
    <div class="modal" id="incomingFileModal">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
            <div class="modal-title">
                üì• Incoming File
                <button class="modal-close" onclick="declineFile()">√ó</button>
            </div>
            <div class="file-info">
                <div class="file-icon" id="fileIcon">üìÑ</div>
                <div class="file-details">
                    <div class="file-name" id="incomingFileName">filename.txt</div>
                    <div class="file-meta">
                        <span id="incomingFileSize">0 KB</span>
                        <span>from</span>
                        <span id="incomingFileSender" style="color: var(--accent);">User</span>
                    </div>
                </div>
            </div>
            <div class="file-actions">
                <button class="file-btn decline" onclick="declineFile()">Decline</button>
                <button class="file-btn accept" onclick="acceptFile()">Accept</button>
            </div>
        </div>
    </div>

    <!-- File Transfer Progress Modal -->
    <div class="modal" id="transferModal">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
            <div class="modal-title">
                <span id="transferTitle">üì§ Sending File</span>
            </div>
            <div class="file-info">
                <div class="file-icon" id="transferFileIcon">üìÑ</div>
                <div class="file-details">
                    <div class="file-name" id="transferFileName">filename.txt</div>
                    <div class="file-meta" id="transferStatus">Connecting...</div>
                </div>
            </div>
            <div class="transfer-progress">
                <div class="progress-bar-transfer">
                    <div class="progress-fill-transfer" id="transferProgress"></div>
                </div>
                <div class="progress-text" id="transferPercent">0%</div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for sharing -->
    <input type="file" id="shareFileInput" style="display:none" onchange="handleShareFile(event)">

    <!-- Main Application Script -->
    <script src="app.js"></script>
</body>
</html>
