<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Roboto:wght@300;400;500&display=swap">
    <link href="https://arjunchakri.github.io/favicon.png" rel="icon" sizes="16x16">

    <link rel="preconnect" href="https://docs.google.com">
    <link rel="preconnect" href="https://script.google.com">

    <title>Terminal Notes</title>
    <style>
        /* --- GLOBAL --- */
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden;
            font-family: 'Roboto', sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
        }

        /* --- THE "SOFT EXPANSION" TRANSITION --- */
        .view-section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;

            /* Initial State: Hidden & Slightly Smaller */
            opacity: 0;
            visibility: hidden;
            pointer-events: none;

            /* Start at 98% scale (roughly size of terminal) */
            transform: scale(0.98);

            /* Minimalist Easing: Starts quick, lands soft */
            transition:
                opacity 0.5s ease-in-out,
                transform 0.5s cubic-bezier(0.25, 1, 0.5, 1),
                visibility 0.5s step-end;

            will-change: transform, opacity;
        }

        .view-section.active {
            /* Active State: Visible & Full Screen */
            opacity: 1;
            visibility: visible;
            pointer-events: auto;

            transform: scale(1);

            transition:
                opacity 0.5s ease-in-out,
                transform 0.5s cubic-bezier(0.25, 1, 0.5, 1),
                visibility 0s step-start;
        }

        /* --- TERMINAL WINDOW STYLES --- */
        .terminal-container {
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            background: #0d1117;
            z-index: 20;
        }

        .terminal-window {
            width: 90%; max-width: 600px;
            /* Glassmorphism for the window only */
            background: rgba(22, 27, 34, 0.6);
            border: 1px solid #30363d;
            border-radius: 6px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            font-family: 'Fira Code', 'Courier New', monospace;
            overflow: hidden;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .terminal-header {
            background: rgba(22, 27, 34, 0.95);
            padding: 10px 15px;
            border-bottom: 1px solid #30363d;
            display: flex; gap: 8px;
            align-items: center;
        }
        .header-title { margin-left: auto; margin-right: auto; font-size: 0.75rem; color: #8b949e; letter-spacing: 1px;}
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .red { background: #ff5f56; }
        .yellow { background: #ffbd2e; }
        .green { background: #27c93f; }

        .terminal-body {
            padding: 25px;
            color: #c9d1d9;
            font-size: 0.9rem;
            line-height: 1.6;
            min-height: 160px;
        }

        /* --- DASHBOARD CONTENT --- */
        .comment { color: #8b949e; font-style: italic; display: block; margin-bottom: 4px; }
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .obj { color: #79c0ff; }

        .command-prompt { display: flex; align-items: center; margin-top: 25px; border-top: 1px solid #30363d; padding-top: 20px;}
        .prompt-symbol { color: #7ee787; margin-right: 12px; font-weight: bold; }

        input.cli-input {
            background: transparent;
            border: none;
            color: #c9d1d9;
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            width: 100%;
            outline: none;
            caret-color: #58a6ff;
        }
        input.cli-input::placeholder { color: #484f58; opacity: 0.5; }

        /* --- LOADER CONTENT --- */
        .log-line { margin: 4px 0; display: block; }
        .success { color: #3fb950; }
        .warn { color: #d29922; }
        .cmd { color: #c9d1d9; }
        .cursor {
            display: inline-block; width: 8px; height: 16px;
            background: #58a6ff; animation: blink 1s step-end infinite;
            vertical-align: middle; margin-left: 5px;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- VIEWER & UTILS --- */
        #viewer {
            border: none;
            /* Match background to body to prevent white flash during transition */
            background: #0d1117;
            z-index: 10;
        }

        #toggle-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 50;
            padding: 8px 12px; background: #222; color: #fff;
            border: 1px solid #444; border-radius: 4px; cursor: pointer;
            font-family: 'Fira Code', monospace; font-size: 0.75rem;
            opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
        #toggle-btn.visible { opacity: 0.6; pointer-events: auto; }
        #toggle-btn.visible:hover { opacity: 1; }

        .cache-reset { position: fixed; bottom: 10px; left: 10px; color: #444; font-size: 10px; cursor: pointer; z-index: 100; font-family: 'Fira Code', monospace; text-decoration: none; opacity: 0.3; transition: opacity 0.2s;}
        .cache-reset:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <div id="dashboard" class="view-section terminal-container">
        <div class="terminal-window">
            <div class="terminal-header">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
                <span class="header-title">notes — 80x24</span>
            </div>
            <div class="terminal-body">
                <div><span class="keyword">require</span>(<span class="string">'./arjunchakri_notes_v2'</span>);</div>
                <br>
                <div class="comment">// Zero Login. Zero Setup. Minimalist notes.</div>
                <div class="comment">// Accessible from anywhere.</div>
                <br>
                <div class="command-prompt">
                    <span class="prompt-symbol">➜</span>
                    <input type="text" id="topicInput" class="cli-input" placeholder="Name of your note" autocomplete="off" spellcheck="false" onkeypress="handleEnter(event)">
                </div>
            </div>
        </div>
    </div>

    <div id="loader" class="view-section terminal-container">
        <div class="terminal-window">
            <div class="terminal-header">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
                <span class="header-title">boot_sequence</span>
            </div>
            <div class="terminal-body" id="term-logs">
                <span class="log-line">> init process...</span>
                <span class="cursor"></span>
            </div>
        </div>
    </div>

    <button id="toggle-btn" onclick="toggleViewMode()">Toggle Mode</button>
    <a href="#" class="cache-reset" onclick="resetCache()">[RESET_CACHE]</a>

    <iframe id="viewer" class="view-section"></iframe>

    <script>
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5Fy4CHje4vEyBdUdyw02WNhZoZKdGUtn0MLAA7dAB0o7EbDBHxc5GyE9S0qN0AawY1A/exec";
        /*
        Above script if you want to host your own version on Google App Scripts Engine
        
        // Version 6 on 3 Jan 2026, 18:51
        
        function doGet(e) {
            var key = e.parameter.key;
            if (!key) key = 'dashboard';

            // 1. Search for existing file
            var files = DriveApp.getFilesByName(key);
            
            if (files.hasNext()) {
                return ContentService.createTextOutput(files.next().getId());
            } else {
                // 2. Create new file if not found
                var doc = DocumentApp.create(key);
                var body = doc.getBody();
                var file = DriveApp.getFileById(doc.getId());
                
                // 3. Set Permissions (Public Edit)
                file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.EDIT);
                
                // 4. APPLY STYLES (The Fix)
                styleAsCodeEditor(body);
                
                // 5. Add Header
                body.setText("// Notes: " + key + "\n\n");
                
                doc.saveAndClose();
                return ContentService.createTextOutput(doc.getId());
            }
            }

            function styleAsCodeEditor(body) {
            var bgColor = "#1e1e1e"; // Dark Grey
            var textColor = "#d4d4d4"; // Light Grey
            var font = "Roboto Mono"; 
            
            // --- LAYOUT SETTINGS ---
            // 1. Landscape Mode (Swap A4 dimensions: 595pt x 842pt)
            // We use standard point sizes. 842 = Width, 595 = Height.
            body.setPageWidth(842);
            body.setPageHeight(595);
            
            // 2. End-to-End (Zero Margins)
            // Note: We leave a tiny 10pt padding so text doesn't touch the screen edge exactly
            body.setMarginTop(10);
            body.setMarginBottom(10);
            body.setMarginLeft(10); 
            body.setMarginRight(10);

            // --- STYLE SETTINGS ---
            var style = {};
            style[DocumentApp.Attribute.BACKGROUND_COLOR] = bgColor;
            style[DocumentApp.Attribute.FOREGROUND_COLOR] = textColor;
            style[DocumentApp.Attribute.FONT_FAMILY] = font;
            style[DocumentApp.Attribute.FONT_SIZE] = 11;
            
            // Apply attributes
            body.setAttributes(style);
        }
        */
        
        
        
        const CACHE_PREFIX = "note_cache_";

        let currentFileId = null;
        let isMinimalMode = true;

        // --- Logger Logic ---
        function log(msg, type = "") {
            const container = document.getElementById('term-logs');
            const cursor = document.querySelector('.cursor');
            const line = document.createElement('span');
            line.className = "log-line " + type;
            line.innerText = "> " + msg;
            container.insertBefore(line, cursor);
            container.scrollTop = container.scrollHeight;
        }

        async function runBootSequence(key, isCached) {
            const container = document.getElementById('term-logs');
            container.innerHTML = '<span class="log-line">> init process...</span><span class="cursor"></span>';

            await wait(200);
            log(`target: ${key}`, "cmd");

            await wait(300);
            if(isCached) {
                log("cache hit: [MEMORY]", "success");
                log("expanding workspace...", "warn");
            } else {
                log("querying upstream...", "cmd");
                log("handshake: drive_api", "cmd");
            }
        }

        function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

        // --- Core View Switching ---
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(viewId);
            if(target) target.classList.add('active');

            if(viewId === 'dashboard') {
                setTimeout(() => document.getElementById('topicInput').focus(), 100);
            }
        }

        function getNoteKey() {
            const qs = window.location.search;
            return (qs && qs.length > 1) ? decodeURIComponent(qs.substring(1)) : null;
        }

        function loadViewer(fileId) {
            currentFileId = fileId;
            const iframe = document.getElementById('viewer');
            const toggleBtn = document.getElementById('toggle-btn');

            iframe.src = `https://docs.google.com/document/d/${fileId}/edit?rm=minimal`;

            iframe.onload = async () => {
                log("rendering gui...", "cmd");
                await wait(500);
                log("SESSION ESTABLISHED.", "success");
                await wait(200);

                // Trigger the soft transformation
                switchView('viewer');

                setTimeout(() => toggleBtn.classList.add('visible'), 600);
            };
        }

        // --- Main Execution ---
        const noteKey = getNoteKey();

        if (!noteKey) {
            document.title = "Terminal Notes";
            switchView('dashboard');
        } else {
            document.title = `./${noteKey}`;
            switchView('loader');

            const cachedId = localStorage.getItem(CACHE_PREFIX + noteKey);

            if (cachedId) {
                runBootSequence(noteKey, true);
                loadViewer(cachedId);
            } else {
                runBootSequence(noteKey, false);

                fetch(`${APPS_SCRIPT_URL}?key=${encodeURIComponent(noteKey)}`)
                    .then(r => r.text())
                    .then(async fileId => {
                        if (fileId.includes("Error") || fileId.length < 5) throw new Error(fileId);

                        await wait(400);
                        log("id recv: " + fileId.substring(0,8)+"...", "success");
                        log("permissions: [WRITE]", "warn");

                        localStorage.setItem(CACHE_PREFIX + noteKey, fileId);
                        loadViewer(fileId);
                    })
                    .catch(err => {
                        log("FATAL: " + err.message, "error"); // Red text if error defined in CSS
                        console.error(err);
                    });
            }
        }

        // --- Utils ---
        function toggleViewMode() {
            if (!currentFileId) return;
            const iframe = document.getElementById('viewer');
            isMinimalMode = !isMinimalMode;
            iframe.src = `https://docs.google.com/document/d/${currentFileId}/edit${isMinimalMode ? '?rm=minimal' : ''}`;
        }

        function goToTopic() {
            const input = document.getElementById('topicInput');
            let val = input.value.trim();
            if(val.startsWith("./")) val = val.substring(2);
            if(val) window.location.search = `?${val}`;
        }

        function handleEnter(e) {
            if (e.key === 'Enter') goToTopic();
        }

        function resetCache() {
            localStorage.clear();
            location.reload();
        }
    </script>
</body>
</html>
