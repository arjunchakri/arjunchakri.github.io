<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://arjunchakri.github.io/favicon.png" rel="icon" sizes="16x16">
    <link rel="apple-touch-icon" href="https://arjunchakri.github.io/notes/icon/ios_iconA.png">
    <link rel="apple-touch-startup-image" href="https://arjunchakri.github.io/favicon.png" >
    
    <title>Loading Note...</title>
    <style>
        /* Reset and Layout */
        body, html { 
            margin: 0; 
            padding: 0; 
            height: 100%; 
            width: 100%; 
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* The Iframe (Hidden initially) */
        #viewer { 
            width: 100vw; 
            height: 100vh; 
            border: none; 
            display: none; 
            position: absolute;
            top: 0;
            left: 0;
        }

        /* The Loading Screen */
        #loader { 
            display: flex; 
            flex-direction: column;
            height: 100vh; 
            justify-content: center; 
            align-items: center; 
            background: #ffffff; 
            color: #333;
            z-index: 10;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        h2 { font-weight: 400; margin: 0; }
        p { color: #888; margin-top: 5px; font-size: 0.9rem; }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <h2 id="status">Initializing...</h2>
        <p id="substatus">Please wait</p>
    </div>

    <iframe id="viewer"></iframe>

    <script>
        // ================= CONFIGURATION =================
        // PASTE YOUR GOOGLE APPS SCRIPT WEB APP URL BELOW:
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw5Fy4CHje4vEyBdUdyw02WNhZoZKdGUtn0MLAA7dAB0o7EbDBHxc5GyE9S0qN0AawY1A/exec"; 
        
        // Name of your repository. 
        // If your URL is username.github.io/notes/, this should be 'notes'
        const REPO_NAME = "notes"; 
        // =================================================

        function getNoteKey() {
            // 1. Get the full path (e.g. /notes/dsa_heap)
            const path = window.location.pathname;
            
            // 2. Remove trailing slashes
            const cleanPath = path.replace(/\/$/, "");
            
            // 3. Extract the last segment
            const segments = cleanPath.split('/');
            const lastSegment = segments[segments.length - 1];

            // 4. Check if we are at the root (just /notes/)
            // If the last segment is the repo name, user didn't type a note name.
            if (lastSegment.toLowerCase() === REPO_NAME.toLowerCase() || lastSegment === "") {
                return "dashboard"; // Default file name
            }
            
            return decodeURIComponent(lastSegment);
        }

        // --- Main Execution ---
        const noteKey = getNoteKey();
        const statusText = document.getElementById('status');
        const subStatus = document.getElementById('substatus');
        const iframe = document.getElementById('viewer');
        const loader = document.getElementById('loader');

        // Update UI immediately
        document.title = `${noteKey}`;
        statusText.innerText = `Opening: ${noteKey}`;
        subStatus.innerText = "Connecting to Drive...";

        // Fetch the Doc ID
        fetch(`${APPS_SCRIPT_URL}?key=${encodeURIComponent(noteKey)}`)
            .then(response => response.text())
            .then(fileId => {
                if (fileId.includes("Error") || fileId.length < 10) {
                    throw new Error("Invalid ID returned");
                }

                subStatus.innerText = "Loading editor...";
                
                // Load Google Doc in Minimal Mode
                iframe.src = `https://docs.google.com/document/d/${fileId}/edit?rm=minimal`;
                
                // When iframe finishes loading, hide the loader
                iframe.onload = () => {
                    loader.style.display = "none";
                    iframe.style.display = "block";
                };
            })
            .catch(err => {
                statusText.innerText = "Connection Failed";
                subStatus.innerText = "Check your internet or Script URL.";
                subStatus.style.color = "red";
                console.error(err);
            });
    </script>
</body>
</html>